name: Docker
on: [push]
jobs:
  build-and-push:
    name: Deploy Docker Image
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - name: Build and push
        uses: openzim/docker-publish-action@v4
        with:
          image-name: asonger/elastic-detection-cli
          registries: |
            docker.io
#           ghcr.io
          credentials: |
            DOCKERIO_USERNAME=${{ secrets.DOCKERHUB_USERNAME }}
            DOCKERIO_TOKEN=${{ secrets.DOCKERHUB_PASSWORD }}
#            GHCRIO_USERNAME=${{ secrets.GOOGLE_USERNAME }}
#            GHCRIO_USERNAME=${{ secrets.GOOGLE_TOKEN }}
          context: sub-folder
          on-master: dev
          tag-pattern: /^v*([0-9.]+)$/
          latest-on-tag: true
          restrict-to: openzim/zimit
          build-args:
            VERSION={tag}
          manual-tag: ${{ github.event.inputs.version }}


